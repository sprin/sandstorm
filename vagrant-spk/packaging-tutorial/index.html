<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Packaging tutorial - Sandstorm</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Packaging tutorial";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../analytics.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Sandstorm</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Using</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guided-tour/">Guided tour</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/top-bar/">Top bar</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/how-it-works/">How it works</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/security-practices/">Security practices</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing apps</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Overview of vagrant-spk</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Packaging tutorial</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#packaging-tutorial-generic">Packaging tutorial (Generic)</a></li>
                
                    <li><a class="toctree-l4" href="#overview-of-sandstorm-packages">Overview of Sandstorm packages</a></li>
                
                    <li><a class="toctree-l4" href="#before-proceeding-install-vagrant-spk">Before proceeding, install vagrant-spk</a></li>
                
            
                <li class="toctree-l3"><a href="#creating-a-package">Creating a package</a></li>
                
                    <li><a class="toctree-l4" href="#choose-an-app-that-you-will-package">Choose an app that you will package</a></li>
                
                    <li><a class="toctree-l4" href="#create-sandstorm-to-store-packaging-information-for-the-app">Create .sandstorm, to store packaging information for the app</a></li>
                
                    <li><a class="toctree-l4" href="#start-a-virtual-linux-machine-containing-sandstorm">Start a virtual Linux machine containing Sandstorm</a></li>
                
                    <li><a class="toctree-l4" href="#examine-the-sandstorm-instance-you-will-develop-against">Examine the Sandstorm instance you will develop against</a></li>
                
                    <li><a class="toctree-l4" href="#use-vagrant-spk-to-create-a-package-definition-file-for-your-app">Use vagrant-spk to create a package definition file for your app</a></li>
                
                    <li><a class="toctree-l4" href="#make-the-app-available-in-the-sandstorm-in-development-mode">Make the app available in the Sandstorm, in development mode</a></li>
                
                    <li><a class="toctree-l4" href="#stop-the-development-server-and-create-a-package-file">Stop the development server and create a package file</a></li>
                
            
                <li class="toctree-l3"><a href="#stop-the-virtual-machine-running-your-app-and-sandstorm">Stop the virtual machine running your app and Sandstorm</a></li>
                
            
                <li class="toctree-l3"><a href="#whats-next">What's next</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../packaging-tutorial-meteor/">Packaging tutorial (Meteor)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/publishing-apps/">App publishing guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/handbook/">App Developer Handbook</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/auth/">User authentication & permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/path/">Paths and URLs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../customizing/">Understanding & customizing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../platform-stacks/">Platform stacks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../code-dependencies/">Code dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../services/">Service dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/web-publishing/">Web publishing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/http-apis/">Exporting HTTP APIs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/email-from-apps/">Email from apps</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../design/">vagrant-spk design document</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing on raw Sandstorm</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-packaging-guide/">Raw packaging guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-python/">Raw integration of Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-ruby-on-rails/">Raw integration of Ruby on Rails</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-pure-client-apps/">Raw integration of pure client apps</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Administering</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/sandcats/">Sandcats dynamic DNS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/email/">Email</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/demo/">Demo mode</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/backups/">Backups</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/wildcard/">Wildcard hosts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/reverse-proxy/">Reverse Proxy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/ssl/">HTTPS & SSL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/faq/">Frequently asked questions</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Sandstorm</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developing apps &raquo;</li>
        
      
    
    <li>Packaging tutorial</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/sandstorm-io/sandstorm/tree/master/docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="packaging-tutorial-generic">Packaging tutorial (Generic)</h1>
<p>Style: Hands-on introductory tutorial.</p>
<p>This tutorial will show you how to package an app for
<a href="https://sandstorm.io">Sandstorm</a> in five minutes. Going through
this tutorial, you'll learn:</p>
<ul>
<li>
<p>How to take an existing web application and turn into a Sandstorm
  package (SPK).</p>
</li>
<li>
<p>How our packaging helper (<code>vagrant-spk</code>) lets you edit the app's files on your
  main operating system (Mac or Linux; working on Windows support), even though Sandstorm apps always
  run on Linux.</p>
</li>
</ul>
<p>The tutorial uses a PHP app as an example. <strong>Sandstorm supports any
programming language that runs on Linux</strong>, not just PHP, such as
Meteor, Python, Rails, Node, PHP, C++, Go, Rust, and more. Read about
<a href="../platform-stacks/">vagrant-spk's platform stacks</a> to see how to optimize
your package for your app's programming language.</p>
<p>Once you've worked through this tutorial, look in the <strong>Next steps</strong> section
at the bottom of this document to learn more about how to improve the speed
of packaging on your computer, learn about user authentication and
permissions in Sandstorm, and more.</p>
<h2 id="overview-of-sandstorm-packages">Overview of Sandstorm packages</h2>
<p>A Sandstorm application package includes all the code needed to run your
app, including all binaries, libraries, modules, etc. Normally, figuring out
exactly what to put in a package could be tedious, and if you decide to include
everything, it would result in a massive package file. Sandstorm makes it easy to keep things
small by employing a trick: it watches your server running on your development machine
and pulls in all the files the server uses.</p>
<p>Keeping the package small means that it's easy for people to install and update
the package you're creating.</p>
<p>Sandstorm packages rely on the Sandstorm platform to handle adding new user
accounts and other access control elements. Read more in the
<a href="../../developing/handbook/">App Developer Handbook</a>.</p>
<h2 id="before-proceeding-install-vagrant-spk">Before proceeding, install vagrant-spk</h2>
<p>Make sure you've worked through the
<a href="../installation/">vagrant-spk installation guide</a> before going through this tutorial!</p>
<h1 id="creating-a-package">Creating a package</h1>
<p>Over the course of section, we will use <code>vagrant-spk</code> to create a
Sandstorm package containing the app and all its dependencies.</p>
<h3 id="choose-an-app-that-you-will-package">Choose an app that you will package</h3>
<p>This tutorial uses a sample PHP web app. To download it, run the following commands:</p>
<pre><code class="bash">cd ~/projects
git clone git://github.com/paulproteus/php-app-to-package-for-sandstorm
</code></pre>

<p>The app's code will be stored at
<code>~/projects/php-app-to-package-for-sandstorm</code>.  We will spend the rest
of the tutorial in that directory and its sub-directories.</p>
<p><strong>Note</strong>: Feel free to spend a moment looking around this folder you
just downloaded. You'll find an <code>index.php</code> and some CSS and
Javascript.</p>
<h2 id="create-sandstorm-to-store-packaging-information-for-the-app">Create .sandstorm, to store packaging information for the app</h2>
<p>Over the course of this tutorial, we will create and modify the
<code>.sandstorm/</code> directory in the project. This directory contains the Sandstorm
packaging information, such as the app name and the scripts required to
create the package.</p>
<p>We'll use the <code>vagrant-spk</code> tool to create this directory.</p>
<p>The purpose of <code>vagrant-spk</code> is to create a Linux system where Sandstorm and
your app run successfully. It acts differently based on which <em>language platform</em>
you want to use. In our case, we'll use the <em>lemp</em> platform: Linux, nginx, MySQL,
and PHP.</p>
<p>To do that, run the following commands:</p>
<pre><code class="bash">cd ~/projects/php-app-to-package-for-sandstorm
vagrant-spk setupvm lemp
</code></pre>

<p>You should see a message like the following:</p>
<pre><code class="bash">Initializing .sandstorm directory in /Users/myself/projects/php-app-to-package-for-sandstorm/.sandstorm
</code></pre>

<p>You should also find that the <code>.sandstorm/</code> directory now exists in your project.
Here's how you can take a look:</p>
<pre><code class="bash">ls ~/projects/php-app-to-package-for-sandstorm/.sandstorm
</code></pre>

<h2 id="start-a-virtual-linux-machine-containing-sandstorm">Start a virtual Linux machine containing Sandstorm</h2>
<p>The next step is to start the virtual Linux machine, containing
Sandstorm, that you will develop the package with. To do that, run the following
command:</p>
<pre><code class="bash">vagrant-spk up
</code></pre>

<p>(You should be running it from the <code>~/projects/php-app-to-package-for-sandstorm</code> directory.)</p>
<p>You will see a <em>lot</em> of messages printed out. Some of them are not necessary;
we're working on tidying up the scripts to minimize the noise.</p>
<p>Eventually, you will see this mesage:</p>
<pre><code class="bash">==&gt; default: Processing triggers for php5-fpm (5.6.9+dfsg-0+deb8u1) ...
</code></pre>

<p>and get your shell back. At this point, you can continue to the next step.</p>
<p><strong>Troubleshooting note</strong>: If you already have Sandstorm installed on your laptop,
you might see the following red text:</p>
<pre><code class="bash">Vagrant cannot forward the specified ports on this VM, since they
would collide with some other application that is already listening
on these ports. The forwarded port to 6080 is already in use
on the host machine.
</code></pre>

<p>If you see that, run:</p>
<pre><code class="bash">sudo service sandstorm stop
</code></pre>

<p>and halt any other <code>vagrant-spk</code> virtual machines you might be using to develop
other apps.</p>
<h2 id="examine-the-sandstorm-instance-you-will-develop-against">Examine the Sandstorm instance you will develop against</h2>
<p>Your system is now running a Sandstorm instance. You should visit it
in your web browser now by visiting</p>
<p>http://local.sandstorm.io:6080/</p>
<p>Take a moment now to sign in by clicking on <strong>Sign in</strong> in the top-right corner.
Choose <strong>Sign in with a Dev account</strong> and choose <strong>Alice (admin)</strong> as the user
to sign in with.</p>
<p>Note that there are other "dev accounts" available -- you can use this to test
the experience of using your app as other users.</p>
<p>Over the next few steps, we will prepare the app so that it is visible in that
Sandstorm instance.</p>
<!--(**Editor's note**: We should make localhost:6080 work, so that people don't have to learn about `local.sandstorm.io`.)-->

<h2 id="use-vagrant-spk-to-create-a-package-definition-file-for-your-app">Use vagrant-spk to create a package definition file for your app</h2>
<p>Every Sandstorm package needs to declare its name. It does this in a
<code>sandstorm-pkgdef.capnp</code> file. (<code>capnp</code> is short for Cap'n Proto; for the
purpose of this tutorial, Cap'n Proto is a configuration file format that is
easy for Sandstorm to parse.)</p>
<p>Let's use <code>vagrant-spk</code> to create a package definition file by running:</p>
<pre><code class="bash">vagrant-spk init
</code></pre>

<p>(You should be running it from the <code>~/projects/php-app-to-package-for-sandstorm</code> directory.)</p>
<p>This will create a new file called <code>.sandstorm/sandstorm-pkdef.capnp</code>.</p>
<p>We'll make two changes. First, we'll give our app a <strong>title</strong> of
<em>Sandstorm Showcase</em>. To do that, open <code>.sandstorm/sandstorm-pkgdef.capnp</code> in
a text editor and find the line with this text:</p>
<pre><code class="bash">    appTitle = (defaultText = &quot;Example App&quot;),
</code></pre>

<p>Change it to the following.</p>
<pre><code class="bash">    appTitle = (defaultText = &quot;Sandstorm Showcase&quot;),
</code></pre>

<p>Second, we will customize the text that Sandstorm users see when they want
to create a new <em>instance</em> of the app. To do this, find the line containing:</p>
<pre><code class="bash">      ( title = (defaultText = &quot;New Instance&quot;),
</code></pre>

<p>and change it to read:</p>
<pre><code class="bash">      ( title = (defaultText = &quot;New Showcase&quot;),
</code></pre>

<h2 id="make-the-app-available-in-the-sandstorm-in-development-mode">Make the app available in the Sandstorm, in development mode</h2>
<p>Sandstorm app development focuses around <code>dev</code> mode, which makes the current
code of an app available.</p>
<p>Make this app available in dev mode by doing:</p>
<pre><code class="bash">vagrant-spk dev
</code></pre>

<p>(You should be running it from the <code>~/projects/php-app-to-package-for-sandstorm</code> directory.)</p>
<p>On the terminal, you will see a message like:</p>
<pre><code class="bash">App is now available from Sandstorm server. Ctrl+C to disconnect.
</code></pre>

<p>Now you can visit the Sandstorm at http://local.sandstorm.io:6080/ and log in
as <strong>Alice (admin)</strong>. Your app name should appear in the list of apps.</p>
<p>You can click <strong>New Showcase</strong> and see the PHP code running.</p>
<p>Note that each app instance (each "Showcase", for this app) runs separate from
each other. You can see that for this app because the app stores the number
of times you have reloaded the page. If you create another <strong>New Showcase</strong>,
each instance will store their data separately.</p>
<p>In Sandstorm, resources like a database are embedded into the package. That
helps enforce this isolation between app instances.</p>
<h2 id="stop-the-development-server-and-create-a-package-file">Stop the development server and create a package file</h2>
<p>The final step in this tutorial is to create a Sandstorm package (SPK) file,
containing the app and all its dependencies. This SPK file is something that
you can give directly to people who want to use the code, or add to the
Sandstorm app list so people can install it easily from their own servers.</p>
<p>To do that, we first stop the <code>vagrant-spk dev</code> server. To do that, type
<code>Ctrl-C</code> on your keyboard. You will see some messages like:</p>
<pre><code class="bash">Unmounted cleanly.
Updating file list.
</code></pre>

<p>If you're still logged into your Sandstorm instance, you will notice the app
vanishing from the list of apps on the left.</p>
<p>To create the SPK file, run:</p>
<pre><code class="bash">vagrant-spk pack ~/projects/package.spk
</code></pre>

<p>(You should be running it from the <code>~/projects/php-app-to-package-for-sandstorm</code> directory.)</p>
<p>This will take a few moments, and once it is done, there will be a file in
<code>~/projects/package.spk</code> that contains the full app.</p>
<p>You can see how large it is by running the following command:</p>
<pre><code class="bash">du -h ~/projects/package.spk
</code></pre>

<p>On my system, I see:</p>
<pre><code class="bash">16M
</code></pre>

<p>or sixteen megabytes.</p>
<p>Now, you can upload this to your development Sandstorm instance by clicking
*<em>Upload app</em> and choosing this file in your web browser's upload dialog.</p>
<p>To learn how to go further and share this SPK file, or what you should know
for other web frameworks, check out the <strong>What's next</strong> section below.</p>
<!--(**Editor's note**: IMHO vagrant-spk pack should auto-guess a reasonable package filename.)-->

<h1 id="stop-the-virtual-machine-running-your-app-and-sandstorm">Stop the virtual machine running your app and Sandstorm</h1>
<p>With <code>vagrant-spk</code>, before you can develop a second app, you must stop
the virtual machine created as part of developing the first one.  This
is because the <code>vagrant-spk</code> virtual machine always uses port 6080.</p>
<p>In our case, we're done using the virtual machine running this app, so
it's safe to stop it. Run this command:</p>
<pre><code class="bash">vagrant-spk halt
</code></pre>

<p>(You should be running it from the <code>~/projects/php-app-to-package-for-sandstorm</code> directory.)</p>
<p>Now port 6080 is available for other app packaging projects. If you ever want to work on
this app's packaging again, you can bring it up by running:</p>
<pre><code class="bash">vagrant-spk up
</code></pre>

<p>If you ever are confused about which Vagrant virtual machines are
running, you can try this command:</p>
<pre><code class="bash">vagrant global-status
</code></pre>

<p>(<strong>Note</strong>: It's <code>vagrant</code> here, not <code>vagrant-spk</code>.)</p>
<h1 id="whats-next">What's next</h1>
<p>Now that you've seen the basics of how a Sandstorm app works, you
might be interested in any of the following:</p>
<ul>
<li>What makes a great Sandstorm app? See the App Developer Handbook.</li>
<li>How do I learn more about the technical underpinnings of <code>vagrant-spk</code>? How do I make <code>vagrant-spk</code> faster?
Read about <a href="../customizing/">understanding &amp; customizing vagrant-spk</a>.</li>
<li>How do I package-up a Python, Meteor, or other non-PHP app? Read about <a href="../platform-stacks/">platform stacks</a>.</li>
<li>Will this work on Windows? No, not yet. Sorry, we're working on it.</li>
<li>Will this work if I typically run Sandstorm-related programs in a virtual machine? We don't know, but we hope so.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../packaging-tutorial-meteor/" class="btn btn-neutral float-right" title="Packaging tutorial (Meteor)"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../packaging-tutorial-meteor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
