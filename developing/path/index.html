<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Paths and URLs - Sandstorm</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Paths and URLs";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../analytics.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Sandstorm</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Using</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guided-tour/">Guided tour</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/top-bar/">Top bar</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/how-it-works/">How it works</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using/security-practices/">Security practices</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing apps</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/">Overview of vagrant-spk</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/packaging-tutorial/">Packaging tutorial</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/packaging-tutorial-meteor/">Packaging tutorial (Meteor)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../publishing-apps/">App publishing guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../handbook/">App Developer Handbook</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../auth/">User authentication & permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Paths and URLs</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#web-urls">Web URLs</a></li>
                
                    <li><a class="toctree-l4" href="#recommendation-use-the-empty-string-as-your-base-path">Recommendation: Use the empty string as your base path</a></li>
                
                    <li><a class="toctree-l4" href="#alternative-x-sandstorm-base-path">Alternative: X-Sandstorm-Base-Path</a></li>
                
                    <li><a class="toctree-l4" href="#details">Details</a></li>
                
                    <li><a class="toctree-l4" href="#other-headers-available-in-sandstorm">Other headers available in Sandstorm</a></li>
                
            
                <li class="toctree-l3"><a href="#apps-operating-without-sandstorm-http-bridge">Apps operating without sandstorm-http-bridge</a></li>
                
            
                <li class="toctree-l3"><a href="#appendix-impact-on-caching">Appendix: Impact on caching</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/customizing/">Understanding & customizing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/platform-stacks/">Platform stacks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/code-dependencies/">Code dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/services/">Service dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../web-publishing/">Web publishing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../http-apis/">Exporting HTTP APIs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../email-from-apps/">Email from apps</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/design/">vagrant-spk design document</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing on raw Sandstorm</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../raw-packaging-guide/">Raw packaging guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../raw-python/">Raw integration of Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../raw-ruby-on-rails/">Raw integration of Ruby on Rails</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../raw-pure-client-apps/">Raw integration of pure client apps</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Administering</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/sandcats/">Sandcats dynamic DNS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/email/">Email</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/demo/">Demo mode</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/backups/">Backups</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/wildcard/">Wildcard hosts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/reverse-proxy/">Reverse Proxy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/ssl/">HTTPS & SSL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/faq/">Frequently asked questions</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Sandstorm</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developing apps &raquo;</li>
        
      
    
    <li>Paths and URLs</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/sandstorm-io/sandstorm/tree/master/docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Sandstorm apps live at ephemeral URLs. This page documents the
details.</p>
<h2 id="web-urls">Web URLs</h2>
<p>When a Sandstorm grain is running, Sandstorm uses a different URL for
each session. This means even for a single grain, each different user
visiting the site will have a different base URL. There isn't a stable
URL like <code>https://myapp.me.sandcats.io/</code> for an app to use.</p>
<p>Your app might need to use these URLs for:</p>
<ul>
<li>
<p><strong>Redirects</strong>: the app might need to generate redirects, for example
  after a user POSTs some data.</p>
</li>
<li>
<p><strong>Static assets</strong>: the app might have CSS, images, Javascript, or
  other files that are required for a visitor to successfully load a
  page.</p>
</li>
<li>
<p><strong>Links within the app</strong>: If a user is on the home page (<code>/</code>) of an
  app, and the app wants to create a <code>href=</code> link to some other page,
  it needs to know what string to place into the <code>&lt;a href&gt;</code> tag.</p>
</li>
</ul>
<h3 id="recommendation-use-the-empty-string-as-your-base-path">Recommendation: Use the empty string as your base path</h3>
<p>The <strong>easiest</strong> way to handle Sandstorm's dynamic base path is to
use the empty string (<code>''</code>) as your app's base path. This way,
the app needs to make no decisions at runtime.</p>
<p>Many web frameworks support this.</p>
<p>If you can't use the empty string, you can detect the base path at
runtime for every request.</p>
<h3 id="alternative-x-sandstorm-base-path">Alternative: <code>X-Sandstorm-Base-Path</code></h3>
<p><code>sandstorm-http-bridge</code> provides the base URL for this particular
request into the app as an HTTP header: <code>X-Sandstorm-Base-Path</code>.</p>
<p>For example, if the user requests the page
<code>http://7575abdec6caa44bb83df0e00d7d8605.me.sandcats.io:6080/party</code>,
the app will receive a header of:</p>
<pre><code>X-Sandstorm-Base-Path: http://7575abdec6caa44bb83df0e00d7d8605.me.sandcats.io:6080
</code></pre>

<h3 id="details">Details</h3>
<ul>
<li>
<p><strong>No trailing slash.</strong> This way it is ready for you to add your own
  path e.g. <code>/party</code>.</p>
</li>
<li>
<p><strong>Includes the URI scheme.</strong> Therefore, if you need to check if the
  request is coming in over HTTP vs. HTTPS, you can use this header.</p>
</li>
<li>
<p><strong>Can change with every request.</strong> Recall that this value is unsafe
  to cache in a global settings object, since the next request to your
  grain might use a different value.</p>
</li>
<li>
<p><strong>Not sent for API requests.</strong> All app <a href="../http-apis/">API requests</a>
  share the same HTTP base domain, and this can't be used for HTML
  sent to web browsers, so Sandstorm does not send this header on API
  requests. Additionally, for sandboxing reasons, the API token is
  kept secret from the app.</p>
</li>
</ul>
<h3 id="other-headers-available-in-sandstorm">Other headers available in Sandstorm</h3>
<p>Sandstorm sends a <code>Host:</code> header and an <code>X-Forwarded-Proto</code> for
convenience when porting apps. A request to
<code>http://7575abdec6caa44bb83df0e00d7d8605.me.sandcats.io:6080/party</code>
would also cause an app to receive the following HTTP headers.</p>
<ul>
<li><code>Host: 7575abdec6caa44bb83df0e00d7d8605.me.sandcats.io:6080</code></li>
<li><code>X-Forwarded-Proto: http</code></li>
</ul>
<p>It is therefore OK to look for <code>X-Forwarded-Proto: https</code> to detect
HTTPS if needed.</p>
<p><strong>For API requests</strong>: <code>sandstorm-http-bridge</code> does send a <code>Host</code> value
of <code>sandbox</code> since some apps crash in the absence of a host header. It
does not send a <code>X-Forwarded-Proto</code> however.</p>
<h2 id="apps-operating-without-sandstorm-http-bridge">Apps operating without sandstorm-http-bridge</h2>
<p><code>X-Sandstorm-Base-Path</code> is created from the <code>WebSession</code> attribute
called <code>basePath</code>. Read the <a href="https://github.com/sandstorm-io/sandstorm/blob/71fd830f0f1ac9fd1b759e4492eb70dabe001c48/src/sandstorm/web-session.capnp">current
implementation</a>
for its Cap'n Proto documentation. Consider also reading the source of
<a href="https://github.com/sandstorm-io/sandstorm/blob/master/src/sandstorm/sandstorm-http-bridge.c++#L1033">sandstorm-http-bridge</a>.</p>
<h2 id="appendix-impact-on-caching">Appendix: Impact on caching</h2>
<p>The fact that Sandstorm apps must send their static assets (such as
CSS, Javascript, and images) on different URLs per session means that
a web browser can't make good use of its cache.</p>
<p>This can have a negative impact on app load time in Sandstorm and
mobile data use when compared to other hosting options. The Cap'n
Proto definition of <code>WebSession</code> attribute indicates some possible
future work in creating a shared space in Sandstorm that apps can push
these assets to.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../vagrant-spk/customizing/" class="btn btn-neutral float-right" title="Understanding & customizing"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../auth/" class="btn btn-neutral" title="User authentication & permissions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../auth/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../vagrant-spk/customizing/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
