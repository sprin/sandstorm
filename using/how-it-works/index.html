<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How it works - Sandstorm</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "How it works";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../analytics.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Sandstorm</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Using</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guided-tour/">Guided tour</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../top-bar/">Top bar</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">How it works</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#how-it-works">How It Works</a></li>
                
                    <li><a class="toctree-l4" href="#http-communication-overview">HTTP Communication Overview</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../security-practices/">Security practices</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing apps</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/">Overview of vagrant-spk</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/packaging-tutorial/">Packaging tutorial</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/packaging-tutorial-meteor/">Packaging tutorial (Meteor)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/publishing-apps/">App publishing guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/handbook/">App Developer Handbook</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/auth/">User authentication & permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/path/">Paths and URLs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/customizing/">Understanding & customizing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/platform-stacks/">Platform stacks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/code-dependencies/">Code dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/services/">Service dependencies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/web-publishing/">Web publishing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/http-apis/">Exporting HTTP APIs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/email-from-apps/">Email from apps</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant-spk/design/">vagrant-spk design document</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing on raw Sandstorm</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-packaging-guide/">Raw packaging guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-python/">Raw integration of Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-ruby-on-rails/">Raw integration of Ruby on Rails</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developing/raw-pure-client-apps/">Raw integration of pure client apps</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Administering</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/sandcats/">Sandcats dynamic DNS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/email/">Email</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/demo/">Demo mode</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/backups/">Backups</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/wildcard/">Wildcard hosts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/reverse-proxy/">Reverse Proxy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/ssl/">HTTPS & SSL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../administering/faq/">Frequently asked questions</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Sandstorm</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Using &raquo;</li>
        
      
    
    <li>How it works</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/sandstorm-io/sandstorm/tree/master/docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-it-works">How It Works</h1>
<ul>
<li>Sandstorm's server-side sandboxing is based on the same underlying Linux kernel features as LXC and Docker.  We use the system calls directly for finer-grained control.</li>
<li>(Planned) The kernel attack surface is reduced using seccomp-bpf to block and/or virtualize system calls.</li>
<li>procfs, sysfs, etc. are not mounted in the sandbox, and only a minimal set of devices are available.</li>
<li>(Planned) On the client side, apps run in a sandboxed iframe employing the <code>Content-Security-Policy</code> header to prevent them from sending any kind of network communication to any server other than their own.</li>
<li>All communication between the sandboxed server and the outside world takes place through a single <a href="http://capnproto.org">Cap'n Proto</a> RPC socket which the app's root process receives as file descriptor #3.  We've provided a program, <code>sandstorm-http-bridge</code>, which can receive HTTP-over-RPC requests on this socket and proxy them to a regular HTTP server running in the sandbox.</li>
<li>Every object (e.g., each document) that you create with an application runs in a separate isolated sandbox.  We sandbox per-object rather than per-app so that it is easy and safe to share one object without also sharing everything created using the same app.</li>
<li>An application package (<code>.spk</code> file) is essentially an archive containing an entire chroot environment in which the application runs.</li>
<li>The application runs with the contents of its package mounted read-only, so that multiple instances of the same app can share disk space for the package.</li>
<li>The application may store persistent state in the <code>/var</code> directory.</li>
<li>App servers are aggressively killed off as soon as the user closes the browser tab, then restarted when the user returns later.</li>
<li>Packages are cryptographically signed.  Packages signed with the same key represent versions of the same app, and are thus allowed to replace older versions -- although the user must still confirm these upgrades.</li>
</ul>
<h2 id="http-communication-overview">HTTP Communication Overview</h2>
<p>While web clients speak HTTP to Sandstorm, all communications between Sandstorm
and the grain occur over the Cap'n Proto WebSession format.  With existing
applications, the Sandstorm HTTP bridge is used to translate between Cap'n
Proto and HTTP.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: communication_overview_http_app Pages: 1 -->
<svg width="558pt" height="115pt"
 viewBox="0.00 0.00 558.00 115.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111)">
<title>communication_overview_http_app</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-111 554,-111 554,4 -4,4"/>
<g id="clust1" class="cluster"><title>cluster_sandstorm</title>
<polygon fill="none" stroke="black" points="97,-13 97,-94 328,-94 328,-13 97,-13"/>
<text text-anchor="middle" x="212.5" y="-78.8" font-family="Times,serif" font-size="14.00">Sandstorm</text>
</g>
<g id="clust2" class="cluster"><title>cluster_grain</title>
<polygon fill="none" stroke="black" points="348,-8 348,-99 542,-99 542,-8 348,-8"/>
<text text-anchor="middle" x="445" y="-83.8" font-family="Times,serif" font-size="14.00">Grain</text>
</g>
<!-- client -->
<g id="node1" class="node"><title>client</title>
<polygon fill="none" stroke="black" points="69,-60 0,-60 0,-24 69,-24 69,-60"/>
<text text-anchor="middle" x="34.5" y="-45" font-family="Times,serif" font-size="10.00">Web client</text>
<text text-anchor="middle" x="34.5" y="-34" font-family="Times,serif" font-size="10.00">(eg. browser)</text>
</g>
<!-- proxy -->
<g id="node2" class="node"><title>proxy</title>
<polygon fill="none" stroke="black" points="163,-60 105,-60 105,-24 163,-24 163,-60"/>
<text text-anchor="middle" x="134" y="-45" font-family="Times,serif" font-size="10.00">Proxy</text>
<text text-anchor="middle" x="134" y="-34" font-family="Times,serif" font-size="10.00"> (proxy.js)</text>
</g>
<!-- client&#45;&#45;proxy -->
<g id="edge1" class="edge"><title>client&#45;&#45;proxy</title>
<path fill="none" stroke="black" d="M69.054,-42C80.7319,-42 93.7024,-42 104.893,-42"/>
</g>
<!-- websession -->
<g id="node3" class="node"><title>websession</title>
<polygon fill="none" stroke="black" points="320,-62.5 199,-62.5 199,-21.5 320,-21.5 320,-62.5"/>
<text text-anchor="middle" x="259.5" y="-50.5" font-family="Times,serif" font-size="10.00">WebSession Serialization</text>
<text text-anchor="middle" x="259.5" y="-39.5" font-family="Times,serif" font-size="10.00">(HTTP over Cap&#39;n Proto,</text>
<text text-anchor="middle" x="259.5" y="-28.5" font-family="Times,serif" font-size="10.00">web&#45;session.capnp)</text>
</g>
<!-- proxy&#45;&#45;websession -->
<g id="edge2" class="edge"><title>proxy&#45;&#45;websession</title>
<path fill="none" stroke="black" d="M163.024,-42C173.699,-42 186.314,-42 198.816,-42"/>
</g>
<!-- bridge -->
<g id="node4" class="node"><title>bridge</title>
<polygon fill="none" stroke="black" points="436,-68 356,-68 356,-16 436,-16 436,-68"/>
<text text-anchor="middle" x="396" y="-56" font-family="Times,serif" font-size="10.00">Sandstorm</text>
<text text-anchor="middle" x="396" y="-45" font-family="Times,serif" font-size="10.00">HTTP Bridge</text>
<text text-anchor="middle" x="396" y="-34" font-family="Times,serif" font-size="10.00">(sandstorm&#45;http</text>
<text text-anchor="middle" x="396" y="-23" font-family="Times,serif" font-size="10.00">&#45;bridge.c++)</text>
</g>
<!-- websession&#45;&#45;bridge -->
<g id="edge3" class="edge"><title>websession&#45;&#45;bridge</title>
<path fill="none" stroke="black" d="M320.277,-42C332.344,-42 344.737,-42 355.874,-42"/>
</g>
<!-- app -->
<g id="node5" class="node"><title>app</title>
<polygon fill="none" stroke="black" points="534,-60 472,-60 472,-24 534,-24 534,-60"/>
<text text-anchor="middle" x="503" y="-39.5" font-family="Times,serif" font-size="10.00">HTTP App</text>
</g>
<!-- bridge&#45;&#45;app -->
<g id="edge4" class="edge"><title>bridge&#45;&#45;app</title>
<path fill="none" stroke="black" d="M436.098,-42C447.876,-42 460.618,-42 471.731,-42"/>
</g>
</g>
</svg>

<p>When an application can speak Cap'n Proto directly to Sandstorm, the HTTP
bridge is not needed.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: communication_overview_native_app Pages: 1 -->
<svg width="490pt" height="105pt"
 viewBox="0.00 0.00 490.00 105.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 101)">
<title>communication_overview_native_app</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-101 486,-101 486,4 -4,4"/>
<g id="clust1" class="cluster"><title>cluster_sandstorm</title>
<polygon fill="none" stroke="black" points="97,-8 97,-89 328,-89 328,-8 97,-8"/>
<text text-anchor="middle" x="212.5" y="-73.8" font-family="Times,serif" font-size="14.00">Sandstorm</text>
</g>
<g id="clust2" class="cluster"><title>cluster_grain</title>
<polygon fill="none" stroke="black" points="348,-11 348,-86 474,-86 474,-11 348,-11"/>
<text text-anchor="middle" x="411" y="-70.8" font-family="Times,serif" font-size="14.00">Grain</text>
</g>
<!-- client -->
<g id="node1" class="node"><title>client</title>
<polygon fill="none" stroke="black" points="69,-55 0,-55 0,-19 69,-19 69,-55"/>
<text text-anchor="middle" x="34.5" y="-40" font-family="Times,serif" font-size="10.00">Web client</text>
<text text-anchor="middle" x="34.5" y="-29" font-family="Times,serif" font-size="10.00">(eg. browser)</text>
</g>
<!-- proxy -->
<g id="node2" class="node"><title>proxy</title>
<polygon fill="none" stroke="black" points="163,-55 105,-55 105,-19 163,-19 163,-55"/>
<text text-anchor="middle" x="134" y="-40" font-family="Times,serif" font-size="10.00">Proxy</text>
<text text-anchor="middle" x="134" y="-29" font-family="Times,serif" font-size="10.00"> (proxy.js)</text>
</g>
<!-- client&#45;&#45;proxy -->
<g id="edge1" class="edge"><title>client&#45;&#45;proxy</title>
<path fill="none" stroke="black" d="M69.054,-37C80.7319,-37 93.7024,-37 104.893,-37"/>
</g>
<!-- websession -->
<g id="node3" class="node"><title>websession</title>
<polygon fill="none" stroke="black" points="320,-57.5 199,-57.5 199,-16.5 320,-16.5 320,-57.5"/>
<text text-anchor="middle" x="259.5" y="-45.5" font-family="Times,serif" font-size="10.00">WebSession Serialization</text>
<text text-anchor="middle" x="259.5" y="-34.5" font-family="Times,serif" font-size="10.00">(HTTP over Cap&#39;n Proto,</text>
<text text-anchor="middle" x="259.5" y="-23.5" font-family="Times,serif" font-size="10.00">web&#45;session.capnp)</text>
</g>
<!-- proxy&#45;&#45;websession -->
<g id="edge2" class="edge"><title>proxy&#45;&#45;websession</title>
<path fill="none" stroke="black" d="M163.024,-37C173.699,-37 186.314,-37 198.816,-37"/>
</g>
<!-- app -->
<g id="node4" class="node"><title>app</title>
<polygon fill="none" stroke="black" points="466,-55 356,-55 356,-19 466,-19 466,-55"/>
<text text-anchor="middle" x="411" y="-40" font-family="Times,serif" font-size="10.00">Native Sandstorm App</text>
<text text-anchor="middle" x="411" y="-29" font-family="Times,serif" font-size="10.00">(speaks Cap&#39;n Proto )</text>
</g>
<!-- websession&#45;&#45;app -->
<g id="edge3" class="edge"><title>websession&#45;&#45;app</title>
<path fill="none" stroke="black" d="M320.016,-37C331.741,-37 343.989,-37 355.538,-37"/>
</g>
</g>
</svg>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../security-practices/" class="btn btn-neutral float-right" title="Security practices"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../top-bar/" class="btn btn-neutral" title="Top bar"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../top-bar/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../security-practices/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
